<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<script>
		'use strict';
		const log= console.log;
		Element.prototype.removeAllChildren= function() {
			for(;this.hasChildNodes();)
				this.removeChild(this.lastChild);
		};
		window.onload= ()=>{
			/*fetch('content')
				.then((resp)=>resp.json().then((resp)=>{
					document.querySelector('#page').innerHTML= resp.title+"<br>"+resp.body;
					console.log(resp);}));*/
			const menu= document.querySelector('#menu');
			const bar= document.querySelector('#bar');
			const logo= document.querySelector('#logo');
			const page= document.querySelector("#page");
			const title= document.querySelector('#title');
			const content= document.querySelector('#content');
			const articlePreviewList= document.createElement('div');
			const visit= (articleJSON)=>{
				title.innerHTML= articleJSON.title;
				content.innerHTML= articleJSON.content;
			};
			articlePreviewList.id= 'article-list';
			fetch('list.json').then((resp)=>{resp.json().then((pages)=>{
				Promise.all(pages.map((page)=>fetch('articles/'+page+'.json').then((resp)=>resp.json().then((json)=>[page,json])))).then((articles)=>{
					articles.forEach(([page,json])=>{
						//log('ret:',[page,json]);
						//log('page:',page,', articleJSON:',json);
						const articlePreview= document.createElement('div');
						articlePreview.classList.add('article-preview','clickable');
						articlePreview.addEventListener('click',()=>visit(json));
						articlePreview.innerHTML= json.title+'<br><small>'+json.headline+'</small>';
						articlePreviewList.append(articlePreview);
					});
				});
			});});
			const home= ()=>{
				title.innerHTML= 'Our Articles';
				content.removeAllChildren();
				content.append(articlePreviewList);
			};
			{
				const parts= window.location.href.split('#');
				if(parts.length===1)
					home();
				else
					// this needs to be implemented
					loadPage(parts[1]);
			}
			logo.addEventListener('click',()=>{log('logo clicked');home();});
			[
				['Who we are','admin'],
				['Subscribe','subscribe']
			].forEach(([name,page])=>fetch(page+'.json').then((resp)=>resp.json().then((json)=>{
				log('button:',[name,page]);
				const button= document.createElement('div');
				button.addEventListener('click',()=>{visit(json)});
				button.innerHTML= name;
				menu.append(button);
			})));
		}
	</script>
	<style>
		body {
			margin: 0;
			background-color:lightgreen;
		}
		#bar {
			//display:flex;
			color:white;
			background-color:red;
			//white-space:nowrap;
			//overflow:auto;
			align-items:stretch;
			text-align:center;
			vertical-align:center;
		}
		#menu {
			//align-itms:center;
			//height:auto;
			white-space:nowrap;
			//display:table-cell;
			overflow:auto;
			//text-align:center;
			//display:flex;
			//vertical-align:middle;
			//justify-content:center;
		}
		#logo {
			//display:block;
			padding:3px;
			float:left;
			//vertical-align:middle;
			//align-self:stretch;
			background-color:green;
			display:box;
			box-pack:center;
			box-align:center;
		}
		#logo-center {
			display:inline;
			vertical-align:center;
		}
		.clickable {
			cursor: pointer;
		}
		.article-preview {
			text-align:center;
			background-color:violet;
			margin: 10px;
			padding: 10px;
			border-radius:10px;
			align-self: center;
		}
		#menu div {
			cursor: pointer;
			padding: 10px;
			margin: 10px;
			display: inline-block;
			background-color:blue;
			border-radius:10px;
		}
		#menu div:hover {
			background-color:slateblue;
		}
		#title {
			text-align:center;
			font-size:2em;
		}
		#article-list {
			white-space:wrap;
			flex-direction:column;
			display:flex;
			text-align:center;
		}
	</style>
</head>
<body>
	<div id=bar><div id=logo class=clickable><div id=logo-center>The Flounder</div></div><div id=menu></div></div>
	<div id=page>
		<div id=title></div>
		<div id=content></div>
	</div>
</body>
</html>
